---
title: "Pilot Experiment 1 Analysis"
author: "Matt Crump and Patrick Ihejirika"
date: "12/15/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


This is a pilot analysis of 5 subjects worth of data collected from a pilot version of this experiment. Data collected 12/2021.

## Load libraries

```{r}
library(pacman)
library(dplyr)
library(tidyverse)
library(jsonlite)
```



## Import Data

```{r}
# Read the text file from JATOS ...
read_file('../experiments/DF_pictures_1/jatos_results_20211206204357.txt') %>%
  # ... split it into lines ...
  str_split('\n') %>% first() %>%
  # ... filter empty rows ...
  discard(function(x) x == '') %>%
  # ... parse JSON into a data.frame
  map_dfr(fromJSON, flatten=T) -> data
```

## Pre-processing

Note: In the pilot experiment script, the stimulus duration time was encoded to the data file during the encoding phase, but not during the recognition memory test phase. The following R code chunk, analyzes the encoding phase for each participant, and adds the stimulus duration time factor to the recognition memory test phase data.

```{r}

# add stimulus encoding factor

all_data <- data.frame()
for( sub in unique(data$ID)){
  
  temp_data <- data %>%
    filter(ID==sub)
  
  temp_study <- temp_data %>%
    filter(experiment_phase == "study")
  
  temp_test <- temp_data %>%
    filter(experiment_phase == "test")
  
  encoding_time <- c()
  for(i in 1: dim(temp_test)[1]){
    im_name <- temp_test[i,]$study_item_image_name
    get_trial <- temp_study %>%
      filter(image_name == im_name)
    encoding_time[i]<-get_trial$stimulus_time
  }
  
  temp_test <- cbind(temp_test,encoding_time)
  all_data <- rbind(all_data,temp_test)
}
```

## Get means across Conditions

```{r}
# select data from test phase
filtered_data <- all_data %>%
  filter(experiment_phase == "test")

# get mean accuracy in each condition for each subject
get_means <- filtered_data %>%
  group_by(ID,encoding_time,encoding_instruction,test_condition)%>%
  summarize(mean_correct = mean(correct))

# get mean accuracy in each condition across subjects
get_group_means <- get_means %>%
  group_by(encoding_time,encoding_instruction,test_condition)%>%
  summarize(grp_mean_correct = mean(mean_correct),
            sem = sd(mean_correct)/sqrt(length(mean_correct)))

# print table
knitr::kable(get_group_means)

# print graph
library(ggplot2)

ggplot(get_group_means, aes(x=encoding_instruction,y=grp_mean_correct,group=test_condition, color=test_condition))+
  geom_line()+
  geom_errorbar(aes(ymin = grp_mean_correct-sem,
                    ymax = grp_mean_correct+sem),
                width=.2)+
  geom_point()+
  facet_wrap(~encoding_time)+
  coord_cartesian(ylim=c(.4,1))+
  geom_hline(yintercept=.5)+
  scale_y_continuous(breaks = seq(0.4,1,.1))

```

## Main effect of test condition

```{r}

get_group_means <- get_means %>%
  group_by(test_condition)%>%
  summarize(grp_mean_correct = mean(mean_correct),
            sem = sd(mean_correct)/sqrt(length(mean_correct)))

ggplot(get_group_means, aes(x=test_condition,y=grp_mean_correct))+
  geom_bar(stat="identity")+
  geom_errorbar(aes(ymin = grp_mean_correct-sem,
                    ymax = grp_mean_correct+sem),
                width=.2)+
  geom_point()+
  coord_cartesian(ylim=c(.4,1))+
  geom_hline(yintercept=.5)+
  scale_y_continuous(breaks = seq(0.4,1,.1))

```

## Main effect of stimulus duration

```{r}

get_group_means <- get_means %>%
  group_by(encoding_time)%>%
  summarize(grp_mean_correct = mean(mean_correct),
            sem = sd(mean_correct)/sqrt(length(mean_correct)))

ggplot(get_group_means, aes(x=encoding_time,y=grp_mean_correct))+
  geom_bar(stat="identity")+
  geom_errorbar(aes(ymin = grp_mean_correct-sem,
                    ymax = grp_mean_correct+sem),
                width=.2)+
  geom_point()+
  coord_cartesian(ylim=c(.4,1))+
  geom_hline(yintercept=.5)+
  scale_y_continuous(breaks = seq(0.4,1,.1))

```

## Main effect of directed forgetting

```{r}

get_group_means <- get_means %>%
  group_by(encoding_instruction)%>%
  summarize(grp_mean_correct = mean(mean_correct),
            sem = sd(mean_correct)/sqrt(length(mean_correct)))

ggplot(get_group_means, aes(x=encoding_instruction,y=grp_mean_correct))+
  geom_bar(stat="identity")+
  geom_errorbar(aes(ymin = grp_mean_correct-sem,
                    ymax = grp_mean_correct+sem),
                width=.2)+
  geom_point()+
  coord_cartesian(ylim=c(.4,1))+
  geom_hline(yintercept=.5)+
  scale_y_continuous(breaks = seq(0.4,1,.1))

```

## Results section

```{r}
# get means for each subject in each condition
# select data from test phase
filtered_data <- all_data %>%
  filter(experiment_phase == "test")

# get mean accuracy in each condition for each subject
subject_means <- filtered_data %>%
  group_by(ID,encoding_time,encoding_instruction,test_condition)%>%
  summarize(mean_correct = mean(correct))

# convert IVs to factors for RM anova
subject_means <- subject_means %>%
  mutate(ID = as.factor(ID),
         encoding_time = as.factor(encoding_time),
         encoding_instruction = as.factor(encoding_instruction),
         test_condition = as.factor(test_condition))

# 2x2x3 Repeated measures ANOVA

aov_out <- aov(mean_correct ~ encoding_instruction*test_condition*encoding_time + Error(ID/(encoding_instruction*test_condition*encoding_time)), data= subject_means)

summary(aov_out)

# try a t-test

subject_means_t <- filtered_data %>%
  group_by(ID,encoding_instruction)%>%
  summarize(mean_correct = mean(correct))

t.test(mean_correct ~ encoding_instruction, paired=TRUE, data=subject_means_t)

t.test(mean_correct ~ encoding_instruction, paired=TRUE, data=subject_means_t)$statistic^2

# Report individual main effects and interactions
```

## Writing the results section

```{r}
aov_summary <- summary(aov_out)
print_anova <- papaja::apa_print(aov_summary)
print_anova$full_result$encoding_instruction_test_condition
print_anova$full_result$encoding_instruction_encoding_time
print_anova$full_result$test_condition_encoding_time
print_anova$full_result$encoding_instruction_test_condition_encoding_time
```

The proportion of accurately recognized encoding stimuli was collected for each of the subjects who participated in the pilot study. The recorded proportions were then averaged according to the conditions present in this 2x2x3 within subjects experimental design. Mean proportion correct for each subject was then submitted to a 2: Cue instruction conditions  (R vs F), by 2: Test conditions (Novel vs Exemplar), by 3: Stimulus duration conditions (500ms vs 1000ms vs 2000ms), repeated measures analysis of variance.

The main effect of cue instruction condition was, `r print_anova$full_result$encoding_instruction`. Mean accuracy in the remember condition was X, and mean accuracy in the forget condition was X. 

The main effect of test condition was, `r print_anova$full_result$test_condition`. Mean accuracy in the novel test condition was X, and mean accuracy in the exemplar test condition was X. 

The main effect of stimulus duration was, `r print_anova$full_result$encoding_time`. Mean accuracy in the 500 ms condition was X, mean accuracy in the 1000 ms condition was X, and mean accuracy in the 2000 ms condition was X. 

The two-way interaction between encoding instruction and test condition was, `r print_anova$full_result$encoding_instruction_test_condition`. The two-way interaction between encoding instruction and stimulus duration was, `r print_anova$full_result$encoding_instruction_encoding_time`. The two-way interaction between test condition and stimulus duration was, `r print_anova$full_result$test_condition_encoding_time`. Finally, the three-way interaction was, `r print_anova$full_result$encoding_instruction_test_condition_encoding_time`.






